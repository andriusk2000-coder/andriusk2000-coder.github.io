<!DOCTYPE html>
<html lang="lt">
<head>
    <meta charset="UTF-8" />
    <title>Kelionƒós biud≈æeto rezultatai ¬∑ Budget Travel AI</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Arial, sans-serif;
            min-height: 100vh;
            color: #f9fafb;
            background: #020617;
        }

        .page {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .hero-bg {
            position: fixed;
            inset: 0;
            background-image:
                linear-gradient(to bottom, rgba(15,23,42,0.8), rgba(15,23,42,0.97)),
                url("hero.jpg.JPG");
            background-size: cover;
            background-position: center;
            z-index: -1;
        }

        header {
            padding: 12px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1000px;
            margin: 0 auto;
        }

        .logo {
            font-weight: 700;
            letter-spacing: 0.08em;
            font-size: 13px;
            text-transform: uppercase;
        }

        .logo span {
            color: #38bdf8;
        }

        .header-link {
            font-size: 12px;
        }

        .header-link a {
            color: #e5e7eb;
            text-decoration: none;
            opacity: 0.9;
        }

        main {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 30px 16px 40px;
        }

        .layout {
            width: 100%;
            max-width: 1000px;
            display: grid;
            gap: 16px;
        }

        @media (min-width: 860px) {
            .layout {
                grid-template-columns: minmax(0, 1.1fr) minmax(0, 1fr);
            }
        }

        .card {
            padding: 18px 16px 20px;
            border-radius: 18px;
            backdrop-filter: blur(22px);
            background: rgba(15,23,42,0.9);
            border: 1px solid rgba(148,163,184,0.6);
            box-shadow:
                0 20px 50px rgba(15,23,42,0.95),
                0 0 32px rgba(56,189,248,0.2);
        }

        .title {
            font-size: 20px;
            margin-bottom: 4px;
        }

        .subtitle {
            font-size: 13px;
            opacity: 0.9;
            margin-bottom: 12px;
        }

        .row {
            display: flex;
            justify-content: space-between;
            font-size: 13px;
            margin-bottom: 5px;
        }

        .label {
            opacity: 0.85;
        }

        .value {
            font-weight: 600;
        }

        .section-title {
            font-size: 14px;
            font-weight: 600;
            margin: 10px 0 6px;
        }

        ul {
            list-style: none;
            padding-left: 0;
            font-size: 13px;
        }

        ul li {
            margin-bottom: 4px;
        }

        .note {
            font-size: 11px;
            opacity: 0.8;
            margin-top: 8px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 8px;
            font-size: 12px;
        }

        th, td {
            padding: 6px 5px;
            text-align: left;
        }

        th {
            border-bottom: 1px solid rgba(148,163,184,0.7);
            opacity: 0.9;
        }

        tr:nth-child(even) td {
            background: rgba(15,23,42,0.8);
        }

        tr:nth-child(odd) td {
            background: rgba(15,23,42,0.55);
        }

        button {
            margin-top: 14px;
            width: 100%;
            padding: 11px 14px;
            border-radius: 999px;
            border: none;
            background: linear-gradient(135deg, #38bdf8, #6366f1);
            color: #020617;
            font-weight: 700;
            cursor: pointer;
            font-size: 14px;
        }

        footer {
            font-size: 11px;
            text-align: center;
            padding: 10px 20px 18px;
            opacity: 0.65;
        }

        .ai-box {
            margin-top: 10px;
            padding: 8px 10px;
            border-radius: 10px;
            background: rgba(15,23,42,0.9);
            border: 1px dashed rgba(148,163,184,0.8);
            font-size: 12px;
        }

        .ai-section-title {
            margin-top: 8px;
            font-weight: 600;
        }

        .ai-list {
            margin-left: 0;
            padding-left: 0;
            list-style: none;
        }

        .ai-list li {
            margin-bottom: 3px;
        }
    </style>
</head>
<body>
<div class="page">
    <div class="hero-bg"></div>

    <header>
        <div class="logo">Budget<span>Travel</span> AI</div>
        <div class="header-link">
            <a href="budget.html">‚Üê GrƒØ≈æti ƒØ skaiƒçiuoklƒô</a>
        </div>
    </header>

    <main>
        <div class="layout">
            <div class="card" id="summary-card">
                <div class="title">Kelionƒós biud≈æeto rezultatai</div>
                <div class="subtitle" id="trip-subtitle"></div>

                <div class="row">
                    <div class="label">Bendras biud≈æetas</div>
                    <div class="value" id="total-budget"></div>
                </div>
                <div class="row">
                    <div class="label">Dien≈≥ skaiƒçius</div>
                    <div class="value" id="days"></div>
                </div>
                <div class="row">
                    <div class="label">Tavo dienos biud≈æetas</div>
                    <div class="value" id="day-budget"></div>
                </div>

                <div class="section-title">Miestas ir rekomendacijos (lokalus skaiƒçiavimas)</div>
                <div class="row">
                    <div class="label">Miesto kain≈≥ lygis</div>
                    <div class="value" id="city-level"></div>
                </div>
                <div class="row">
                    <div class="label">Rekomenduojamas dienos biud≈æetas</div>
                    <div class="value" id="city-suggest"></div>
                </div>

                <p class="note" id="budget-comment"></p>
                <p class="note" id="style-comment"></p>

                <div class="section-title">AI rekomendacijos pagal biud≈æetƒÖ</div>
                <div class="ai-box">
                    <p id="ai-status">Jungiamasi prie AI serverio...</p>
                </div>
            </div>

            <div class="card">
                <div class="section-title">Dienos paskirstymas</div>
                <ul>
                    <li>Maistas: <span id="food"></span> / d.</li>
                    <li>Transportas: <span id="transport"></span> / d.</li>
                    <li>Veiklos / laisvalaikis: <span id="fun"></span> / d.</li>
                </ul>

                <div class="section-title" style="margin-top:12px;">Dien≈≥ biud≈æeto lentelƒó</div>
                <table>
                    <thead>
                    <tr>
                        <th>Diena</th>
                        <th>Maistas (‚Ç¨)</th>
                        <th>Transportas (‚Ç¨)</th>
                        <th>Veiklos (‚Ç¨)</th>
                        <th>I≈° viso (‚Ç¨)</th>
                    </tr>
                    </thead>
                    <tbody id="days-table-body"></tbody>
                </table>

                <button onclick="window.location.href='budget.html'">
                    Susiplanuoti kitƒÖ kelionƒô
                </button>

                <p class="note">
                    Skaiƒçiavimai yra orientaciniai. Vƒóliau jie gali b≈´ti patikslinti su realiais
                    duomenimis ir (jei norƒósi) tikru dirbtiniu intelektu.
                </p>
            </div>
        </div>
    </main>

    <footer>
        ¬© <span id="year"></span> Budget Travel AI
    </footer>
</div>

<script>
    document.getElementById("year").textContent = new Date().getFullYear();

    const params = new URLSearchParams(window.location.search);

    const cityRaw = (params.get("city") || "").trim();
    const days = Number(params.get("days") || 0);
    const budget = Number(params.get("budget") || 0);
    const style = params.get("style") || "balanced";

    const fmt = (num) => num.toFixed(2).replace(".", ",");

    if (!cityRaw || !Number.isFinite(days) || !Number.isFinite(budget) || days <= 0 || budget <= 0) {
        document.getElementById("summary-card").innerHTML =
            "<div class='title'>Klaida</div><p class='subtitle'>Neteisingi duomenys. GrƒØ≈æk atgal ir ƒØvesk informacijƒÖ dar kartƒÖ.</p>";
    } else {
        const city = cityRaw;
        const cityKey = cityRaw.toLowerCase();
        const dayBudget = budget / days;

        const cityProfiles = {
            "vilnius":   { label: "pigesnis miestas",             baseDay: 60 },
            "kaunas":    { label: "pigesnis miestas",             baseDay: 55 },
            "riga":      { label: "pigesnis miestas",             baseDay: 60 },
            "ryga":      { label: "pigesnis miestas",             baseDay: 60 },
            "barcelona": { label: "vidutinio brangumo miestas",   baseDay: 85 },
            "barcelonƒÖ": { label: "vidutinio brangumo miestas",   baseDay: 85 },
            "london":    { label: "brangus miestas",              baseDay: 110 },
            "londonas":  { label: "brangus miestas",              baseDay: 110 },
            "paris":     { label: "brangus miestas",              baseDay: 105 },
            "pary≈æius":  { label: "brangus miestas",              baseDay: 105 },
            "paryzius":  { label: "brangus miestas",              baseDay: 105 }
        };

        const defaultProfile = { label: "vidutinio brangumo miestas", baseDay: 80 };
        const profile = cityProfiles[cityKey] || defaultProfile;

        let styleText;
        let styleComment;
        let recommendedDay = profile.baseDay;

        if (style === "budget") {
            styleText = "Pigiai (taupus stilius)";
            styleComment = "Pasirinktas taupus kelionƒós stilius ‚Äì daugiau dƒómesio biud≈æetui ir ma≈æiau brangi≈≥ veikl≈≥.";
            recommendedDay *= 0.9;
        } else if (style === "comfort") {
            styleText = "Komforti≈°kai";
            styleComment = "Pasirinktas komforti≈°kas kelionƒós stilius ‚Äì daugiau lƒó≈°≈≥ maistui ir patogesnƒóms veikloms.";
            recommendedDay *= 1.15;
        } else {
            styleText = "Balansuota kelionƒó";
            styleComment = "Balansuotas kelionƒós stilius ‚Äì derinamas taupymas ir patogumas.";
        }

        const foodPct = 0.45;
        const transportPct = 0.15;
        const funPct = 0.40;

        const food = dayBudget * foodPct;
        const transport = dayBudget * transportPct;
        const fun = dayBudget * funPct;

        const ratio = dayBudget / recommendedDay;
        let budgetComment;
        if (ratio < 0.8) {
            budgetComment = "Tavo biud≈æetas ≈°iam miestui yra gana taupus ‚Äì reikƒós atid≈æiau planuoti maistƒÖ ir veiklas.";
        } else if (ratio <= 1.2) {
            budgetComment = "Tavo biud≈æetas ≈°iam miestui atrodo subalansuotas ‚Äì galƒósi keliauti gana patogiai.";
        } else {
            budgetComment = "Tavo biud≈æetas ≈°iam miestui gana komforti≈°kas ‚Äì galƒósi sau leisti daugiau veikl≈≥ ir geresnƒØ maistƒÖ.";
        }

        document.getElementById("trip-subtitle").textContent =
            `${city} ¬∑ ${days} d. ¬∑ biud≈æetas ${fmt(budget)} ‚Ç¨ ¬∑ ${styleText}`;
        document.getElementById("total-budget").textContent = fmt(budget) + " ‚Ç¨";
        document.getElementById("days").textContent = days + " d.";
        document.getElementById("day-budget").textContent = fmt(dayBudget) + " ‚Ç¨ / d.";

        document.getElementById("city-level").textContent = profile.label;
        document.getElementById("city-suggest").textContent = fmt(recommendedDay) + " ‚Ç¨ / d.";

        document.getElementById("food").textContent = fmt(food) + " ‚Ç¨";
        document.getElementById("transport").textContent = fmt(transport) + " ‚Ç¨";
        document.getElementById("fun").textContent = fmt(fun) + " ‚Ç¨";

        document.getElementById("budget-comment").textContent = budgetComment;
        document.getElementById("style-comment").textContent = styleComment;

        const tbody = document.getElementById("days-table-body");
        tbody.innerHTML = "";
        for (let i = 1; i <= days; i++) {
            const totalDay = food + transport + fun;
            const tr = document.createElement("tr");
            tr.innerHTML = `
                <td>${i}</td>
                <td>${fmt(food)}</td>
                <td>${fmt(transport)}</td>
                <td>${fmt(fun)}</td>
                <td>${fmt(totalDay)}</td>
            `;
            tbody.appendChild(tr);
        }

        // KVIEƒåIAM TAVO BACKEND SU PSEUDO-AI REKOMENDACIJOMIS
        const apiUrl = "https://ai-backend-ta0h.onrender.com/api/plan-trip";
        const aiStatus = document.getElementById("ai-status");
        aiStatus.textContent = "Jungiamasi prie AI serverio...";

        fetch(apiUrl, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ city, days, budget, style })
        })
            .then((resp) => {
                if (!resp.ok) {
                    throw new Error("HTTP klaida: " + resp.status);
                }
                return resp.json();
            })
            .then((data) => {
                if (data.ok && data.ai) {
                    const ai = data.ai;

                    const recDay = ai.recommendedDayBudget
                        ? `${ai.recommendedDayBudget.toFixed ? ai.recommendedDayBudget.toFixed(2) : ai.recommendedDayBudget} ‚Ç¨ / d.`
                        : "‚Äì";

                    const level = ai.cityLevel || "ne≈æinoma";
                    const analysis = ai.budgetAnalysis || "AI nepateikƒó komentaro.";

                    let html = "";
                    html += `<strong>AI ƒØvertinimas (${city}):</strong><br>`;
                    html += `Miesto kain≈≥ lygis: <strong>${level}</strong><br>`;
                    html += `Rekomenduojamas dienos biud≈æetas: <strong>${recDay}</strong><br><br>`;
                    html += analysis;

                    if (ai.suggestions) {
                        const s = ai.suggestions;
                        const renderList = (title, items) => {
                            if (!items || !items.length) return "";
                            return `
                                <div class="ai-section-title">${title}</div>
                                <ul class="ai-list">
                                    ${items.map(i => `<li>‚Ä¢ ${i}</li>`).join("")}
                                </ul>
                            `;
                        };

                        html += "<br><br><strong>Rekomendacijos pagal biud≈æetƒÖ:</strong>";
                        html += renderList("üçΩ Maistas ir restoranai", s.food);
                        html += renderList("üè® Apgyvendinimas", s.hotels);
                        html += renderList("üöç Transportas", s.transport);
                        html += renderList("üé° Pramogos ir veiklos", s.fun);
                    }

                    aiStatus.innerHTML = html;
                } else {
                    aiStatus.textContent = "Serveris atsakƒó, bet AI duomen≈≥ negavo.";
                }
            })
            .catch((err) => {
                console.error(err);
                aiStatus.textContent = "Nepavyko prisijungti prie AI serverio.";
            });
    }
</script>
</body>
</html>
